# Runs end-to-end test
# TODO: parameterize the enviroment variables where applicable 
#   (for example lib version numbers)
name: E2E Test
on:
    push:
    workflow_dispatch:
env:
    SONOBUOY_VERSION: 0.56.16
    KUBECONFIG: "/root/.kube/config"
    KUBEHOST: 172.17.0.1
    ARCH: amd64
jobs:
    e2e:
        runs-on: rancher/kubectl:v1.25.4
        steps:
        - uses: actions/checkout@v3

        - name: Set up Go
          uses: actions/setup-go@v4
          with:
            go-version: "1.20"
        - name: Run tests 
          run: |
            curl -sL "https://github.com/vmware-tanzu/sonobuoy/releases/download/v${SONOBUOY_VERSION}/sonobuoy_${SONOBUOY_VERSION}_linux_${ARCH}.tar.gz" | tar -xvz -C /usr/local/bin &&
            ./scripts/build && 
            ./scripts/package
